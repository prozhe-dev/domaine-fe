aabe6221feda9453ecfda72cb5d3782a29ec8eda73448db991830db4480b2322:{"__metadata":{"version":0.1},"root":{"steps":[{"step_id":"606c1560-e7f3-11ef-9908-df43350ce805","step_position":[180,-240],"config_field_values":[{"config_field_id":"sort_by","value":"{\"sortKey\":\"CREATED_AT\",\"order\":\"ASCENDING\"}"},{"config_field_id":"max_root_records","value":"100"},{"config_field_id":"query","value":"-handle:\"{{product.handle}}\" AND tag:\"{{runCode.sid}}\""}],"task_id":"shopify::flow::fetch::products","task_version":"v1","task_type":"ACTION","description":"Get other colorways (excluding itself)","note":null,"name":"Get product data"},{"step_id":"0ff7cfb0-e7f4-11ef-9908-df43350ce805","step_position":[-220,-100],"config_field_values":[{"config_field_id":"input","value":"query {\n  product {\n    tags\n  }\n}\n"},{"config_field_id":"script","value":"export default function main({ product }) {\n  // Make sure that the data you return matches the\n  // shape & types defined in the output schema.\n\n  const sid = product.tags.find((tag) => tag.toLowerCase().startsWith(\"sid:\"));\n\n  return {\n    sid\n  };\n}\n"},{"config_field_id":"output_schema","value":"\"The output of Run Code\"\ntype Output {\n  sid: String\n}\n"}],"task_id":"shopify::flow::run_code","task_version":"0.1","task_type":"ACTION","description":null,"note":null,"name":"Run code"},{"step_id":"88838b90-e7f9-11ef-9908-df43350ce805","step_position":[180,80],"config_field_values":[{"config_field_id":"listpath","value":"runCode1.colorways"}],"task_id":"shopify::flow::foreach","task_version":"0.1","task_type":"FOREACH","description":"For each custom colorway object","note":null,"name":null},{"step_id":"431ca310-e82c-11ef-9908-df43350ce805","step_position":[-220,40],"config_field_values":[{"config_field_id":"condition","value":"{\"uuid\":\"2b00b122-e82e-11ef-9908-df43350ce805\",\"lhs\":{\"uuid\":\"45a23c80-e82c-11ef-9908-df43350ce805\",\"parent_uuid\":\"2b00b122-e82e-11ef-9908-df43350ce805\",\"lhs\":{\"uuid\":\"46ef7d00-e82c-11ef-9908-df43350ce805\",\"parent_uuid\":\"45a23c80-e82c-11ef-9908-df43350ce805\",\"value\":\"runCode.sid\",\"comparison_value_type\":\"EnvironmentValue\",\"full_environment_path\":\"runCode.sid\"},\"rhs\":{\"uuid\":\"c296c000-e84d-11ef-aee5-39c015066eb0\",\"parent_uuid\":\"45a23c80-e82c-11ef-9908-df43350ce805\",\"value\":\"\",\"comparison_value_type\":\"LiteralValue\"},\"value_type\":\"EnvironmentScalarDefinition:String\",\"operator\":\"not_empty_and_not_nil?\",\"operation_type\":\"Comparison\"},\"operator\":\"AND\",\"operation_type\":\"LogicalExpression\"}"}],"task_id":"shopify::flow::condition","task_version":"0.1","task_type":"CONDITION","description":"Check if sid tag exists","note":null,"name":null},{"step_id":"7f350a10-e843-11ef-8982-c9d15c5b52f8","step_position":[180,-60],"config_field_values":[{"config_field_id":"input","value":"query{\n  product{\n    id\n    createdAt\n  }\n  getProductData{\n    id\n    createdAt\n  }\n}"},{"config_field_id":"script","value":"export default function main(input) {\n  \n  const product = input.product;\n  const allColorways = input.getProductData;\n\n  const newColorways = [product, ...allColorways].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));\n  \n  const colorways = allColorways.map((colorway) => ({\n    product: colorway.id,\n    metafields: JSON.stringify(newColorways.filter((c) => c.id !== colorway.id).map((c) => c.id)),\n  }))\n  \n  return {\n    colorways\n  }\n}"},{"config_field_id":"output_schema","value":"type Output {\n  colorways: [Colorways]!\n}\n\ntype Colorways {\n  product: ID!\n  metafields: String!\n}"}],"task_id":"shopify::flow::run_code","task_version":"0.1","task_type":"ACTION","description":null,"note":null,"name":"Run code (1)"},{"step_id":"0194f3d8-3553-70d1-8802-9cec51e8ec1d","step_position":[-220,-240],"config_field_values":[],"task_id":"shopify::admin::product_added","task_version":"0.1","task_type":"TRIGGER","description":null,"note":null,"name":null},{"step_id":"dfb19350-e84c-11ef-aee5-39c015066eb0","step_position":[180,240],"config_field_values":[{"config_field_id":"api_call","value":"{\"name\":\"metafieldsSet\",\"blob\":\"{\\n  \\\"metafields\\\": [\\n    {\\n      \\\"ownerId\\\": {{colorwaysForeachitem.product | json}},\\n      \\\"namespace\\\": \\\"custom\\\",\\n      \\\"key\\\": \\\"colorways\\\",\\n      \\\"value\\\": {{colorwaysForeachitem.metafields | json}},\\n      \\\"type\\\": \\\"list.product_reference\\\"\\n    }\\n  ]\\n}\"}"}],"task_id":"shopify::admin::admin_api_operation","task_version":"0.1","task_type":"ACTION","description":null,"note":null,"name":"Send Admin API request"}],"links":[{"from_step_id":"0ff7cfb0-e7f4-11ef-9908-df43350ce805","from_port_id":"output","to_step_id":"431ca310-e82c-11ef-9908-df43350ce805","to_port_id":"input"},{"from_step_id":"431ca310-e82c-11ef-9908-df43350ce805","from_port_id":"true","to_step_id":"606c1560-e7f3-11ef-9908-df43350ce805","to_port_id":"input"},{"from_step_id":"0194f3d8-3553-70d1-8802-9cec51e8ec1d","from_port_id":"output","to_step_id":"0ff7cfb0-e7f4-11ef-9908-df43350ce805","to_port_id":"input"},{"from_step_id":"606c1560-e7f3-11ef-9908-df43350ce805","from_port_id":"output","to_step_id":"7f350a10-e843-11ef-8982-c9d15c5b52f8","to_port_id":"input"},{"from_step_id":"7f350a10-e843-11ef-8982-c9d15c5b52f8","from_port_id":"output","to_step_id":"88838b90-e7f9-11ef-9908-df43350ce805","to_port_id":"input"},{"from_step_id":"88838b90-e7f9-11ef-9908-df43350ce805","from_port_id":"loop_body","to_step_id":"dfb19350-e84c-11ef-aee5-39c015066eb0","to_port_id":"input"}],"patched_fields":[],"workflow_name":"Set Colorways Metafields"}}